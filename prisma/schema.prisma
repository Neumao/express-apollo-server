generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String       @id @default(uuid()) @db.Uuid
  email                   String       @unique
  firstName               String?
  lastName                String?
  profileImageUrl         String?
  isActive                Boolean      @default(true)
  isVerified              Boolean      @default(false)
  role                    Role         @default(USER)
  phoneNumber             String?      @unique
  authToken               String?
  authTokenExpiry         DateTime?
  resetPasswordToken      String?
  resetPasswordExpires    DateTime?
  passwordLastChanged     DateTime?
  emailVerificationToken  String?
  emailVerificationExpiry DateTime?
  failedLoginAttempts     Int          @default(0)
  lastLoginAt             DateTime?
  lastActiveAt            DateTime?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
  deletedAt               DateTime?
  userName                String?
  password                String
  apiRequests             ApiRequest[]
}

model ApiRequest {
  id           String   @id @default(uuid()) @db.Uuid
  endpoint     String
  method       String
  statusCode   Int
  responseTime Int
  userId       String?  @db.Uuid
  userAgent    String?
  ipAddress    String?
  timestamp    DateTime @default(now())
  error        String?
  isCached     Boolean  @default(false)
  isError      Boolean  @default(false)
  user         User?    @relation(fields: [userId], references: [id])

  @@index([timestamp])
  @@index([endpoint])
  @@index([userId])
  @@index([statusCode])
}

enum Role {
  USER
  MODERATOR
  ADMIN
  SYSADMIN
}
